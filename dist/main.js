import{j as e,r as u,R as L,L as H,C as P,X as I,Y as N,T as R,a as z,b as _,c as M,d as V}from"./chunks/vendor-C5M2h91w.js";const g=({name:t,size:s=20,color:r="#333",className:n=""})=>{const a=o=>{switch(o){case"cloud-sun":return"☀️";case"alert":return"⚠️";case"info":return"ℹ️";case"location":return"📍";case"refresh":return"🔄";case"settings":return"⚙️";case"sunrise":return"🌅";case"sunset":return"🌇";case"humidity":return"💧";case"temperature":return"🌡️";case"pressure":return"⏱️";case"wind":return"💨";case"rain":return"☔";case"calendar":return"🗓️";case"location-pin":return"📍";case"thermometer":return"🌡️";case"eye":return"👁️";case"sun":return"☀️";case"air-quality":return"💨";case"snow":return"❄️";default:return""}};return e.jsx("span",{className:`icon ${n}`,style:{fontSize:s,color:r,display:"inline-block",verticalAlign:"middle"},children:a(t)})},O=({lastUpdate:t,sunrise:s,sunset:r,isConnecting:n,hasError:a,onRefresh:o})=>{const l=n?"status-connecting":a?"status-error":"status-online",d=n?"Conectando...":a?"Error":"En línea";return e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"app-title",children:"Dashboard Meteorológico"}),e.jsx("p",{className:"app-subtitle",children:"Tu análisis del clima en tiempo real"})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"info-group",children:[e.jsxs("div",{className:`status-indicator ${l}`,children:[e.jsx("span",{className:"status-dot"}),e.jsxs("span",{children:["Estado: ",d]})]}),e.jsxs("div",{className:"last-update-info",children:[e.jsx(g,{name:"update"}),e.jsxs("span",{children:["Última actualización: ",t]})]}),e.jsxs("div",{className:"sun-times-group",children:[e.jsxs("div",{className:"sun-time-item",children:[e.jsx(g,{name:"sunrise"}),e.jsxs("span",{children:["Amanecer: ",s]})]}),e.jsxs("div",{className:"sun-time-item",children:[e.jsx(g,{name:"sunset"}),e.jsxs("span",{children:["Atardecer: ",r]})]})]})]}),e.jsxs("div",{className:"buttons-group",children:[e.jsxs("button",{className:"refresh-button",onClick:o,disabled:n,children:[e.jsx(g,{name:"refresh"}),"Actualizar"]}),e.jsx("img",{src:"/dashboard/public/sol2.png",alt:"Sol",className:"sun-logo-header",style:{width:"30px",height:"30px"}})]})]})]})},v=({children:t,className:s,title:r,style:n})=>{const a=`card ${s||""}`;return e.jsxs("div",{className:a,style:n,children:[" ",r&&e.jsx("h2",{className:"card-title",children:r}),t]})},q=({hourlyData:t})=>{const s=n=>new Date(n).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}),r=u.useMemo(()=>!t||!t.time||t.time.length===0?[]:t.time.slice(0,24).map((a,o)=>{var i,c;const l=(i=t.temperature_2m)==null?void 0:i[o],d=(c=t.relative_humidity_2m)==null?void 0:c[o];return{hour:s(a),Temperatura:l!==void 0?parseFloat(l.toFixed(1)):null,Humedad:d!==void 0?parseFloat(d.toFixed(0)):null}}).filter(a=>a.Temperatura!==null&&a.Humedad!==null),[t]);return e.jsx(v,{title:"Gráfico de Temperatura y Humedad",children:r.length>0?e.jsx(L,{width:"100%",height:250,children:e.jsxs(H,{data:r,margin:{top:5,right:10,left:-20,bottom:5},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(I,{dataKey:"hour",stroke:"#555"}),e.jsx(N,{yAxisId:"temp",stroke:"#ff7043",label:{value:"Temp (°C)",angle:-90,position:"insideLeft",fill:"#ff7043"}}),e.jsx(N,{yAxisId:"hum",orientation:"right",stroke:"#29b6f6",label:{value:"Humedad (%)",angle:90,position:"insideRight",fill:"#29b6f6"}}),e.jsx(R,{formatter:(n,a,o)=>[`${n}${a==="Temperatura"?"°C":a==="Humedad"?"%":""}`,a],labelFormatter:n=>`Hora: ${n}`,contentStyle:{backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"5px"},labelStyle:{color:"#333"}}),e.jsx(z,{wrapperStyle:{paddingTop:"10px"}}),e.jsx(_,{yAxisId:"temp",type:"monotone",dataKey:"Temperatura",stroke:"#ff7043",activeDot:{r:6},name:"Temperatura"}),e.jsx(_,{yAxisId:"hum",type:"monotone",dataKey:"Humedad",stroke:"#29b6f6",activeDot:{r:6},name:"Humedad Relativa"})]})}):e.jsx("div",{className:"chart-area-placeholder",style:{height:"250px"},children:e.jsx("p",{children:"Cargando datos del gráfico o no hay datos disponibles."})})})},B=({currentLocationName:t,onLocationChange:s,availableLocations:r,hourlyData:n})=>{const a=r[t];return e.jsxs(e.Fragment,{children:[e.jsxs(v,{title:"Selector de Ubicación",children:[e.jsx("div",{className:"location-info",children:e.jsxs("div",{className:"location-item",children:[e.jsx(g,{name:"location"}),e.jsx("span",{children:t})]})}),e.jsxs("div",{className:"location-selector-dropdown",children:[e.jsx(g,{name:"location"}),e.jsx("select",{value:t,onChange:o=>s(o.target.value),children:Object.keys(r).map(o=>e.jsx("option",{value:o,children:o},o))})]}),a&&e.jsxs("div",{className:"coordinates-info",children:[e.jsxs("p",{children:["Coordenadas: ",a.latitude,", ",a.longitude]}),e.jsxs("p",{children:["Zona Horaria: ",a.timezone]})]})]}),e.jsx(q,{hourlyData:n})]})},D=({conditions:t})=>e.jsx(v,{title:"Condiciones Actuales",children:e.jsx("div",{className:"conditions-list",children:t.length>0?t.map(s=>e.jsxs("div",{className:`condition-item condition-level-${s.level.toLowerCase()}`,children:[e.jsxs("div",{className:"condition-header",children:[e.jsx("span",{className:"condition-type",children:s.type}),e.jsx("span",{className:`condition-level-badge condition-level-${s.level.toLowerCase()}`,children:s.level})]}),e.jsx("p",{className:"condition-description",children:s.description}),e.jsxs("div",{className:"condition-meta",children:[e.jsx("span",{className:"condition-time",children:s.time}),e.jsx("span",{className:"condition-location",children:s.location})]})]},s.id)):e.jsx("p",{className:"no-data-message",children:"No hay condiciones especiales reportadas en este momento."})})}),U=({indicator:t})=>e.jsxs(v,{className:"key-indicator-card",style:{background:t.gradient},children:[e.jsxs("div",{className:"indicator-header",children:[e.jsx("span",{className:"indicator-label-title",children:t.label}),e.jsx(g,{name:t.icon})," "]}),e.jsxs("div",{className:"indicator-content-body",children:[e.jsxs("div",{className:"indicator-value-container",children:[e.jsx("span",{className:"indicator-value",children:t.value}),e.jsx("span",{className:"indicator-unit-badge",children:t.unit})]}),t.change&&e.jsx("span",{className:"indicator-change",children:t.change})]})]}),W=({indicators:t})=>e.jsxs(v,{title:"Indicadores Clave",className:"key-indicators-section-card",children:[" ",e.jsxs("div",{className:"indicators-grid",children:[" ",t.map(s=>e.jsx(U,{indicator:s},s.id))]})]}),X=({hourlyData:t})=>{const s=a=>new Date(a).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}),r=a=>a>337.5||a<=22.5?"N":a>22.5&&a<=67.5?"NE":a>67.5&&a<=112.5?"E":a>112.5&&a<=157.5?"SE":a>157.5&&a<=202.5?"S":a>202.5&&a<=247.5?"SO":a>247.5&&a<=292.5?"O":a>292.5&&a<=337.5?"NO":"",n=u.useMemo(()=>!t||!t.time||t.time.length===0?[]:t.time.slice(0,24).map((o,l)=>{var p,h,m;const d=(p=t.temperature_2m)==null?void 0:p[l],i=(h=t.rain)==null?void 0:h[l],c=(m=t.precipitation_probability)==null?void 0:m[l];return{hour:s(o),Temperatura:d!==void 0?parseFloat(d.toFixed(1)):null,Lluvia:i!==void 0?parseFloat(i.toFixed(1)):null,"Prob. Precipitación":c!==void 0?parseFloat(c.toFixed(0)):null}}).filter(o=>o.Temperatura!==null),[t]);return e.jsx("div",{className:"temporal-analysis-section",children:e.jsxs(v,{title:"Pronóstico Horario y Análisis Temporal",children:[e.jsx("h3",{className:"chart-placeholder-title",children:"Gráfico de Temperaturas y Precipitaciones Horarias"}),e.jsx("p",{className:"chart-subtitle",children:"Visualización de las próximas 24 horas."}),e.jsx("div",{className:"chart-area-container",children:n.length>0?e.jsx(L,{width:"100%",height:300,children:e.jsxs(H,{data:n,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#ccc"}),e.jsx(I,{dataKey:"hour",stroke:"#555"}),e.jsx(N,{yAxisId:"left",stroke:"#ff7043",label:{value:"Temp (°C)",angle:-90,position:"insideLeft",fill:"#ff7043"}}),e.jsx(N,{yAxisId:"right",orientation:"right",stroke:"#29b6f6",label:{value:"Prob. Precipitación (%)",angle:90,position:"insideRight",fill:"#29b6f6"}}),e.jsx(R,{formatter:(a,o,l)=>[`${a}${o==="Temperatura"?"°C":o==="Lluvia"?" mm":"%"}`,o],labelFormatter:a=>`Hora: ${a}`,contentStyle:{backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"5px"},labelStyle:{color:"#333"}}),e.jsx(z,{wrapperStyle:{paddingTop:"10px"}}),e.jsx(_,{yAxisId:"left",type:"monotone",dataKey:"Temperatura",stroke:"#ff7043",activeDot:{r:8},name:"Temperatura"}),e.jsx(_,{yAxisId:"right",type:"monotone",dataKey:"Prob. Precipitación",stroke:"#29b6f6",activeDot:{r:8},name:"Prob. Precipitación"})]})}):e.jsx("div",{className:"chart-area-placeholder",children:e.jsx("p",{children:"Cargando datos del gráfico o no hay datos disponibles."})})}),e.jsxs("div",{className:"hourly-forecast-table-container",children:[e.jsx("h3",{children:"Detalle Horario"}),e.jsx("div",{className:"hourly-table-wrapper",children:t&&t.time&&t.time.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hora"}),e.jsx("th",{children:"Temperatura (°C)"}),e.jsx("th",{children:"Humedad (%)"}),e.jsx("th",{children:"Presión (hPa)"}),e.jsx("th",{children:"Viento (km/h)"}),e.jsx("th",{children:"Sensación Térmica (°C)"})]})}),e.jsx("tbody",{children:t.time.slice(0,24).map((a,o)=>{var l,d,i,c,p,h,m,x,f,b,y;return e.jsxs("tr",{children:[e.jsx("td",{children:s(a)}),e.jsx("td",{children:((d=(l=t.temperature_2m)==null?void 0:l[o])==null?void 0:d.toFixed(0))||"N/A"}),e.jsx("td",{children:((c=(i=t.relative_humidity_2m)==null?void 0:i[o])==null?void 0:c.toFixed(0))||"N/A"}),e.jsx("td",{children:((h=(p=t.pressure_msl)==null?void 0:p[o])==null?void 0:h.toFixed(0))||"N/A"}),e.jsxs("td",{children:[((x=(m=t.wind_speed_10m)==null?void 0:m[o])==null?void 0:x.toFixed(0))||"N/A"," ",((f=t.wind_direction_10m)==null?void 0:f[o])!==void 0?r(t.wind_direction_10m[o]):""]}),e.jsx("td",{children:((y=(b=t.apparent_temperature)==null?void 0:b[o])==null?void 0:y.toFixed(0))||"N/A"})]},a)})})]}):e.jsx("p",{className:"no-data-message",children:"No hay datos de pronóstico horario disponibles."})})]})]})})},Y=({latitude:t,longitude:s,timezone:r,refreshTrigger:n})=>{const[a,o]=u.useState(null),[l,d]=u.useState(!0),[i,c]=u.useState(null);return u.useEffect(()=>{(async()=>{var h;d(!0),c(null),console.log(`[DataFetcher] Iniciando fetch de datos para: Lat ${t}, Lon ${s}, TZ ${r}. Disparador: ${n}`);try{const m=`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${s}&timezone=${r}&current=temperature_2m,is_day,wind_speed_10m,precipitation,relative_humidity_2m,pressure_msl,wind_direction_10m&hourly=temperature_2m,relative_humidity_2m,pressure_msl,wind_speed_10m,wind_direction_10m,weather_code,rain,precipitation_probability,apparent_temperature,evapotranspiration&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,weather_code,wind_speed_10m_max,wind_direction_10m_dominant`,x=await fetch(m);if(!x.ok){const b=await x.text();throw new Error(`Error HTTP: ${x.status} - ${x.statusText}. Detalles: ${b}`)}const f=await x.json();console.log("[DataFetcher] Datos recibidos:",f),console.log("[DataFetcher] Hora de la observación actual:",(h=f==null?void 0:f.current)==null?void 0:h.time),o(f)}catch(m){m instanceof Error?c(m.message):c("Un error desconocido ocurrió."),console.error("[DataFetcher] Error durante el fetch:",m)}finally{d(!1),console.log("[DataFetcher] Fetch finalizado. Loading:",!1)}})()},[t,s,r,n]),{data:a,loading:l,error:i}},Z=(t,s)=>{const r=[],n=s;return t.temperature_2m>=20&&t.temperature_2m<=28&&t.precipitation===0&&r.push({id:`cond-pleasant-temp-${Date.now()}-1`,type:"Temperatura Agradable",description:`Disfruta de una temperatura ideal de ${t.temperature_2m}°C.`,level:"Baja",location:n}),t.relative_humidity_2m&&t.relative_humidity_2m<60&&r.push({id:`cond-low-humidity-${Date.now()}-2`,type:"Humedad Baja",description:`Niveles de humedad confortables (${t.relative_humidity_2m}%).`,level:"Baja",location:n}),t.wind_speed_10m<10&&r.push({id:`cond-light-wind-${Date.now()}-3`,type:"Vientos Ligeros",description:`Vientos suaves de ${t.wind_speed_10m} km/h.`,level:"Baja",location:n}),t.is_day&&t.precipitation===0&&r.push({id:`cond-good-visibility-${Date.now()}-4`,type:"Buena Visibilidad",description:"Cielo despejado o parcialmente nublado, buena visibilidad.",level:"Baja",location:n}),t.temperature_2m>30&&r.push({id:`alert-temp-high-${Date.now()}-1`,type:"Alerta de Temperatura Extrema",description:`¡Alerta! Temperatura actual alta: ${t.temperature_2m}°C.`,level:"Alta",location:n}),t.temperature_2m<10&&r.push({id:`alert-temp-low-${Date.now()}-2`,type:"Alerta de Temperatura Fría",description:`¡Alerta! Temperatura actual baja: ${t.temperature_2m}°C.`,level:"Media",location:n}),t.precipitation>.5&&r.push({id:`alert-precip-${Date.now()}-3`,type:"Alerta de Lluvia Significativa",description:`Se está registrando una precipitación de ${t.precipitation} mm.`,level:"Media",location:n}),r},J=(t,s)=>{var p,h;const r=[],n=(m,x)=>m&&typeof m[x]=="number"?m[x]:void 0,a=n(t,"temperature_2m");a!==void 0&&r.push({id:"temp-actual",label:"Temperatura Actual",value:`${a.toFixed(0)}`,unit:"°C",change:(t==null?void 0:t.is_day)===1?"Día":"Noche",icon:"temperature",gradient:"linear-gradient(135deg, #ff7043, #ff4d4d)"});const o=n(t,"relative_humidity_2m");o!==void 0&&r.push({id:"humidity",label:"Humedad Relativa",value:`${o.toFixed(0)}`,unit:"%",change:"Normal",icon:"humidity",gradient:"linear-gradient(135deg, #29b6f6, #0288d1)"});const l=n(t,"pressure_msl");l!==void 0&&r.push({id:"pressure",label:"Presión Atmosférica",value:`${l.toFixed(0)}`,unit:"hPa",change:"Estable",icon:"pressure",gradient:"linear-gradient(135deg, #ab47bc, #7b1fa2)"});const d=n(t,"wind_speed_10m");d!==void 0&&r.push({id:"wind-speed",label:"Velocidad del Viento",value:`${d.toFixed(0)}`,unit:"km/h",change:"Moderado",icon:"wind",gradient:"linear-gradient(135deg, #66bb6a, #388e3c)"});const i=(p=s==null?void 0:s.temperature_2m_max)==null?void 0:p[0];i!==void 0&&r.push({id:"temp-max-daily",label:"Temp. Máx. Hoy",value:`${i.toFixed(0)}`,unit:"°C",change:"",icon:"temperature",gradient:"linear-gradient(135deg, #fbc02d, #f9a825)"});const c=(h=s==null?void 0:s.temperature_2m_min)==null?void 0:h[0];return c!==void 0&&r.push({id:"temp-min-daily",label:"Temp. Mín. Hoy",value:`${c.toFixed(0)}`,unit:"°C",change:"",icon:"temperature",gradient:"linear-gradient(135deg, #42a5f5, #1976d2)"}),r};function Q(){var $,w,S,F,k,E;const t={Pichincha:{latitude:-.2252,longitude:-78.5249,timezone:"America/Guayaquil"},Guayas:{latitude:-2.1962,longitude:-79.8862,timezone:"America/Guayaquil"},Azuay:{latitude:-2.9,longitude:-79,timezone:"America/Guayaquil"},Manabí:{latitude:-.95,longitude:-80.7333,timezone:"America/Guayaquil"},"El Oro":{latitude:-3.25,longitude:-79.9667,timezone:"America/Guayaquil"},Loja:{latitude:-4,longitude:-79.2,timezone:"America/Guayaquil"}},[s,r]=u.useState("Guayas"),[n,a]=u.useState(0),{latitude:o,longitude:l,timezone:d}=t[s],{data:i,loading:c,error:p}=Y({latitude:o,longitude:l,timezone:d,refreshTrigger:n}),[h,m]=u.useState([]),[x,f]=u.useState([]);u.useEffect(()=>{i&&i.current&&i.daily&&i.hourly?(m(Z(i.current,s)),f(J(i.current,i.daily))):(m([]),f([]))},[i,s]),u.useEffect(()=>{var j;if((j=i==null?void 0:i.current)!=null&&j.time){console.log("[App.tsx] Valor de weatherData.current.time (original):",i.current.time);const K=new Date(i.current.time);console.log("[App.tsx] new Date(time) es válido:",!isNaN(K.getTime()))}else console.log("[App.tsx] weatherData.current.time es undefined, null o vacío.")},[($=i==null?void 0:i.current)==null?void 0:$.time]);const b=j=>{Object.keys(t).includes(j)?r(j):console.warn("Ubicación no encontrada en la lista predefinida:",j)},y=u.useCallback(()=>{a(j=>j+1)},[]),G=(w=i==null?void 0:i.current)!=null&&w.time&&i.current.time!==""&&!isNaN(new Date(i.current.time).getTime())?new Date(i.current.time).toLocaleString("es-ES",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A",C=j=>j&&j!==""&&!isNaN(new Date(j).getTime())?new Date(j).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"N/A",A=C((F=(S=i==null?void 0:i.daily)==null?void 0:S.sunrise)==null?void 0:F[0]),T=C((E=(k=i==null?void 0:i.daily)==null?void 0:k.sunset)==null?void 0:E[0]);return u.useEffect(()=>{console.log("[App.tsx] Sunrise formateado:",A),console.log("[App.tsx] Sunset formateado:",T)},[A,T]),c&&!i?e.jsx("div",{className:"loading-screen",children:"Cargando datos del clima..."}):p?e.jsxs("div",{className:"error-screen",children:["Error al cargar los datos: ",p,". Por favor, inténtalo de nuevo más tarde."]}):e.jsx(M.Fragment,{children:e.jsxs("div",{className:"dashboard-container",children:[e.jsx(O,{lastUpdate:G,sunrise:A,sunset:T,isConnecting:c,hasError:!!p,onRefresh:y}),e.jsxs("div",{className:"dashboard-content",children:[e.jsx(v,{className:"analysis-subtitle-card",children:e.jsx("h2",{className:"analysis-subtitle",children:"Análisis meteorológico en tiempo real"})}),e.jsxs("div",{className:"dashboard-grid",children:[e.jsxs("div",{className:"main-content",children:[e.jsx(D,{conditions:h}),e.jsx(W,{indicators:x}),e.jsx(X,{hourlyData:i==null?void 0:i.hourly,currentWeatherData:i==null?void 0:i.current})]}),e.jsx("aside",{className:"sidebar",children:e.jsx(B,{currentLocationName:s,onLocationChange:b,availableLocations:t,hourlyData:i==null?void 0:i.hourly})})]})]})]})})}V.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(Q,{})}));
